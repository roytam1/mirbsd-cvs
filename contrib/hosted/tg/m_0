#!/usr/bin/env mksh
uid=$(id -u)
typeset -l remh=$1
if [[ -z $remh ]]; then
	print Host empty
	exit 1
fi
if ! fgrep -i "Host $remh" $HOME/.etc/ssh/config >/dev/null 2>&1; then
	print Host not configured: $remh
	exit 1
fi

if [ -e /var/run/ssh-agent/$uid/pid.${remh} ]; then
	exec kill $(</var/run/ssh-agent/$uid/pid.${remh})
elif [[ -n $2 ]]; then
	set -A x $(ps x|fgrep ssh|fgrep -v grep|fgrep "ssh -fN ${remh}")
	exec kill ${x[0]}
else
	print PID for $remh not found, no override given!
	exit 1
fi
