# $MirOS: contrib/hosted/tg/code/xchat-randex/Make_nix,v 1.1 2009/06/06 10:13:15 tg Exp $

# overwrite these as desired (e.g. ports)
CC?=		gcc
CCLD?=		${CC}
CPPFLAGS?=
CFLAGS?=	-Os -g
LDFLAGS?=
# overwrite these only when really needed
EXTRA_CFLAGS?=	-fno-strict-aliasing -fwrapv
EXTRA_LDFLAGS?=	-Wl,-O2
# overwritten in Make_xxx for machdep stuff
EXTRA_FLAGS?=
LINK_COMMAND?=	${CCLD} -shared -Wl,-E

# constant section
ARC4RANDOM_C?=	arc4random.c
ARC4RANDOM_O?=	arc4random.o

SRCS=		main.c ${ARC4RANDOM_C}
OBJS=		main.o ${ARC4RANDOM_O}
LIB=		randex

DPADD?=		${LIB}.exp
PLUGIN?=	${LIB}.so

ALL_CFLAGS=	${CPPFLAGS} ${CFLAGS} ${EXTRA_CFLAGS} ${EXTRA_FLAGS}
ALL_LDFLAGS=	${LDFLAGS} ${EXTRA_LDFLAGS}

all: ${PLUGIN}

clean:
	-rm -f ${OBJS} ${LIB}.dll ${LIB}.so

${LIB}.so: ${OBJS} ${DPADD}
	${LINK_COMMAND} ${ALL_CFLAGS} ${ALL_LDFLAGS} -o $@ ${OBJS}

${LIB}.dll: ${OBJS} ${DPADD}
	${DLL_COMMAND} ${OBJS}

.c.o:
	${CC} ${ALL_CFLAGS} -c -o $@ $<
