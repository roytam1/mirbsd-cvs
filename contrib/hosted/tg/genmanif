#!/bin/mksh
# $MirOS: contrib/hosted/tg/genmanif,v 1.2 2014/04/07 20:27:43 tg Exp $
#-
# Copyright © 2014
#	Thorsten Glaser <tg@mirbsd.org>
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un‐
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided “AS IS” and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person’s immediate fault when using the work as intended.
#-
# (enhance later, e.g. symlinks)

function addarg {
	local x

	for x in $1; do
		[[ -e $x ]] && args+=("$1")
		break
	done
}

set -A args
addarg '.*'
addarg '*'

set -o pipefail
exec >MANIFEST
find ${args[*]} -type f -print0 | sort -z | grep -v -z \
    -e '^MANIFEST$' \
    -e '^MANIFEST\.asc$' | xargs -0r md5sum -b --
rv=$?
(( rv )) && print ERRORS OCCURED
(( rv )) && print -u2 E: errors occured
(( rv )) || print 0BF22FC49CA50DF354C7619CAAAA96D2 v1
exit $rv
