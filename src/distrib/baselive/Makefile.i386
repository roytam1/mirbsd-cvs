# $MirOS: src/distrib/baselive/Makefile.i386,v 1.5 2007/03/26 17:41:29 tg Exp $

KERNEL_PREP=	print 'rootdev 6 0\nquit' | config -ef bsd.tmp
BOOT=		${REALOBJDIR}/../../sys/arch/i386/stand/liveboot/boot
CDROM_MDOPTS=	-b boot.iso -c boot.cat \
		-no-emul-boot -boot-load-size 4 -boot-info-table

it: do-cdrom

bsd: ${BSDOBJDIR}/distrib/generic/bsd
	cp -f $> $@

unpack-md:
	${SUDO} cp ${.CURDIR}/${MACHINE}/boot.* ${WRKDIR}/

cdrom-mdcopy:
	${SUDO} cp ${BOOT} ${WRKDIR}/boot.iso
	cd ${WRKDIR} && cksum -a cksum -a rmd160 -a tiger boot.iso >>CKSUM

cdrom-mdboot:
	${DESTDIR}/usr/mdec/installboot -v -h 16 -s 63 -I $$(fgrep \
	    ${WRKDIR}/boot.ldr mkisofs.log | while read start end rest; do \
		print -- $$start $$end; done) ${BOOTXX} ${CDROM}
