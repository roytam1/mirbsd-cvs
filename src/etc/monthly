#!/bin/mksh
# $MirSecuCron$
# $MirOS: src/etc/monthly,v 1.18 2009/03/29 13:04:15 tg Exp $
# $OpenBSD: monthly,v 1.5 1998/02/02 23:08:57 millert Exp $

umask 022
export TZ=UTC PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/mpkg/bin
cd /

print RUNTIME=$(date +%J)
print

if [ -f /etc/monthly.local ];then
	print "Running monthly.local:"
	. /etc/monthly.local
else
	print "Nothing to do!"
fi

if [[ -e /var/log/wtmp ]]; then
	print
	print Doing login accounting for the time since last run
	print and rotating login accounting log file:
	ac -p | sort -nr +1
	if [[ -e /var/log/wtmp.0 ]]; then
		rm -f /var/log/wtmp.0.gz
		gzip -n9 /var/log/wtmp.0
	fi
	install -c -o root -g wheel -m 640 /dev/null /var/log/wtmp.1
	[[ -e /var/log/wtmp.0.gz ]] && mv /var/log/wtmp.0.gz /var/log/wtmp.1.gz
	mv /var/log/wtmp /var/log/wtmp.0
	mv /var/log/wtmp.1 /var/log/wtmp
	gzip -n9 /var/log/wtmp.0
fi
