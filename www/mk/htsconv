# $MirOS: www/mk/htsconv,v 1.1 2007/06/09 23:29:54 tg Exp $
#-
# This file is part of the website of The MirOS Project, which is
# copyrighted material, please read the LICENCE file for details.

mws__pagename=
unset mws__relpath || :

function mws_setname {
	mws__pagename=$2
	# change index to mark $1
}

function mws_subdir {
	integer i=$1
	mws__relpath=
	while (( i-- )); do
		mws__relpath=../$mws__relpath
	done
}

function mws_putheader {
	local rcsid=$1
#DEPEND mk/tmpl.pre
	mws_content <"$TOP"/mk/tmpl.pre
	cat <<-'EOF'
		<!-- $MirOS: www/mk/htsconv,v 1.1 2007/06/09 23:29:54 tg Exp $ -->
	EOF
	print -nr '<small class="rcsid">Generated on '"$(TZ=UTC date +"%F %T")"
	[[ -n $rcsid ]] && print -nr " from $rcsid"
	print '</small>\n'
}

function mws_putfooter {
#DEPEND mk/tmpl.post
	mws_content <"$TOP"/mk/tmpl.post
}

function mws_content {
	sed \
	    -e "s@@RELPATH@@$mws__relpathg" \
	    -e 's\([0-9A-z][-.,0-9A-z]*\)(\(PAPERS\))<a href="/cman/man\2/\1.htm">&</a>g' \
	    -e 's\([0-9A-z][-.,0-9A-z]*\)(\(PSD\))<a href="/cman/man\2/\1.htm">&</a>g' \
	    -e 's\([0-9A-z][-.,0-9A-z]*\)(\(SMM\))<a href="/cman/man\2/\1.htm">&</a>g' \
	    -e 's\([0-9A-z][-.,0-9A-z]*\)(\(USD\))<a href="/cman/man\2/\1.htm">&</a>g' \
	    -e 's\([0-9A-z][-.,0-9A-z]*\)(\([1-9]\)[/0-9A-Za-z]*)<a href="/cman/man\2/\1.htm">&</a>g'
}

function mws_push {
	for param in _pagename _relpath; do
		eval mws__push_$param=\$mws_$param
	done
}

function mws_pop {
	for param in _pagename _relpath; do
		eval mws_$param=\$mws__push_$param
	done
}
