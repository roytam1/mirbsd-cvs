#!/bin/mksh
# $MirOS: www/data/WP2dat,v 1.6 2014/10/02 19:17:13 tg Exp $
#-
# This file is part of the MirBSD website; see LICENCE for details.
#-
# Pipe 'GC12345 Title of the cache' through this.

: ${username=$(id -un)}
if [[ ! -s WP$username.inc ]]; then
	print -ru2 "E: Set username, 'WP$username.inc' not found."
	exit 1
fi

: ${datum=$(date +%Y-%m-%d)}

. "$(dirname "$0")/../mk/common"

num=$(sed -n '/^ID: \([^p]\)/s//\1/p' "WP$username.inc" | tail -1)
num=${1:-$num}
if (( !num )); then
	print -ru2 "E: Number '$num' in 'WP$username.inc' invalid."
	exit 1
fi

while IFS= read -r line; do
	wpcode=${line%% *}
	title=${line#* }
	print ID: $((++num))
	print Date: $datum
	print -r -- "Waypoint: ${wpcode#http://coord.info/}"
	print -r -- "Title: $(xhtml_escape "$title")"
	print -r -- "Tag: D T "
	print -- ----
done

exit 0
