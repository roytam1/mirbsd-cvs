#!/bin/mksh
# $MirOS: www/data/Taglist,v 1.1 2014/07/11 18:41:08 tg Exp $
#-
# This file is part of the website of The MirOS Project, which is
# copyrighted material, please read the LICENCE file for details.

TOP=$(realpath "$(dirname "$0")/..")

sources=
for x in "$@"; do
	if [[ ! -s $x ]]; then
		print -u2 "E: '$x' does not exist"
		exit 1
	fi
	f=$(realpath "$x")
	if [[ $f != *.inc ]]; then
		print -u2 "E: '$f' ('$x') does not end in '.inc'"
		exit 1
	fi
	s_d=${f%/*}
	if [[ $s_d = "$TOP" ]]; then
		s_d=.
	elif [[ $s_d = "$TOP/"* ]]; then
		s_d=${s_d#"$TOP/"}
	else
		print -u2 "E: '$f' ('$x') not below '$TOP'"
		exit 1
	fi
	s_f=${f##*/}
	src=${s_f%.inc}
	sources+=${sources:+ }$src
	eval sourcedir_${src//\-/_}=\$s_d
done

notimesort=1

. "$TOP/mk/common"
. "$TOP/mk/parser"

integer e=-1
while (( ++e < entries )); do
	print -r -- "${e_tag[$e]}"
done | tr ' ' '\n' | sort -u | if [[ -t 1 ]]; then
	rs
else
	cat
fi
