# $MirOS: ports/sysutils/daemontools/Makefile,v 1.3 2005/12/14 23:13:18 tg Exp $

COMMENT=		"collection of tools for managing unix services"
CATEGORIES=		sysutils
DISTNAME=		daemontools-0.76
PKGNAME=		${DISTNAME}-3
HOMEPAGE=		http://cr.yp.to/daemontools.html
RESPONSIBLE=		Thorsten Glaser <tg@66h.42h.de>

# May distribute patches.
# Must not distribute binaries.
# Must not distribute distfiles.
PERMIT_PACKAGE_CDROM=	No
PERMIT_PACKAGE_FTP=	No
PERMIT_DISTFILES_CDROM=	No
PERMIT_DISTFILES_FTP=	"http://cr.yp.to/distributors.html"

DISTFILES=	${DISTNAME}${EXTRACT_SUFX} ${DISTNAME}-man${EXTRACT_SUFX}:0
MASTER_SITES=	http://cr.yp.to/daemontools/
MASTER_SITES0=	${_MASTER_SITE_MIRBSD}

MAN8LIST=	envdir envuidgid fghack multilog setlock setuidgid softlimit \
		supervise svc svok svscan svstat tai64n tai64nlocal \
		svscanboot pgrphack readproctitle

BINLIST=	envdir envuidgid fghack multilog pgrphack readproctitle \
		setlock setuidgid softlimit supervise svc svok svscan \
		svstat tai64n tai64nlocal

WRKDIST=	${WRKDIR}

do-build:
	@echo ${CC} ${CFLAGS} >${WRKSRC}/admin/${DISTNAME}/src/conf-cc
	@echo ${CC} ${CFLAGS} ${LDFLAGS} >${WRKSRC}/admin/${DISTNAME}/src/conf-ld
	@echo ${PREFIX} >${WRKSRC}/admin/${DISTNAME}/src/home
	cd ${WRKSRC}/admin/${DISTNAME}/src && make it

do-install:
.for i in ${BINLIST}
	${INSTALL_PROGRAM} ${WRKSRC}/admin/${DISTNAME}/src/$i ${PREFIX}/bin/
.endfor
	for a in ${WRKSRC}/admin/${DISTNAME}/src/svscanboot \
	    ${WRKDIR}/daemontools-man/svscanboot.8; do \
		chmod u+w $$a; \
		print '%g!/usr/local!s!!${TRUEPREFIX}!g\nwq' | ed -s $$a; \
	done
	print '%g!^/command!s!!${TRUEPREFIX}/bin!\nwq' \
	    | ed -s ${WRKSRC}/admin/${DISTNAME}/src/svscanboot
	${INSTALL_SCRIPT} ${WRKSRC}/admin/${DISTNAME}/src/svscanboot ${PREFIX}/bin/
.for i in ${MAN8LIST}
	${INSTALL_MAN} ${WRKDIR}/daemontools-man/$i.8 ${PREFIX}/man/man8
.endfor

NO_REGRESS=	Yes

.include <bsd.port.mk>
