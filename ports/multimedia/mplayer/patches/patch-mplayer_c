$MirOS: ports/multimedia/mplayer/patches/patch-mplayer_c,v 1.2 2005/05/19 21:44:58 tg Exp $
$OpenBSD: patch-mplayer_c,v 1.3 2005/09/04 23:51:52 espie Exp $
--- mplayer.c.orig	Fri Apr 15 12:14:02 2005
+++ mplayer.c	Wed Dec 28 19:38:41 2005
@@ -184,6 +184,7 @@ static int max_framesize=0;
 #include "libmpcodecs/dec_video.h"
 #include "libmpcodecs/mp_image.h"
 #include "libmpcodecs/vf.h"
+#include "libmpcodecs/vd.h"
 
 extern void vf_list_plugins();
 
@@ -584,7 +585,7 @@ static void exit_sighandler(int x){
         gdb_pid = fork();
         mp_msg(MSGT_CPLAYER, MSGL_INFO, "Forked...\n");
         if (gdb_pid == 0) { // We are the child
-          if (execlp("gdb", "gdb", prog_path, spid, NULL) == -1)
+          if (execlp("gdb", "gdb", prog_path, spid, (char *)NULL) == -1)
             mp_msg(MSGT_CPLAYER, MSGL_ERR, "Couldn't start gdb\n");
         } else if (gdb_pid < 0) 
           mp_msg(MSGT_CPLAYER, MSGL_ERR, "Couldn't fork\n");
@@ -986,13 +987,13 @@ static void log_sub(){
     if (!f) return;
     fprintf(f, "----------------------------------------------------------\n");
     if (subdata->sub_uses_time) {
-	fprintf(f, "N: %s S: %02d:%02d:%02d.%02d E: %02d:%02d:%02d.%02d\n", filename, 
+	fprintf(f, "N: %s S: %02lu:%02lu:%02lu.%02lu E: %02lu:%02lu:%02lu.%02lu\n", filename, 
 		vo_sub_last->start/360000, (vo_sub_last->start/6000)%60,
 		(vo_sub_last->start/100)%60, vo_sub_last->start%100,
 		vo_sub_last->end/360000, (vo_sub_last->end/6000)%60,
 		(vo_sub_last->end/100)%60, vo_sub_last->end%100);
     } else {
-	fprintf(f, "N: %s S: %d E: %d\n", filename, vo_sub_last->start, vo_sub_last->end);
+	fprintf(f, "N: %s S: %lu E: %lu\n", filename, vo_sub_last->start, vo_sub_last->end);
     }
     for (i = 0; i < vo_sub_last->lines; i++) {
 	fprintf(f, "%s\n", vo_sub_last->text[i]);
@@ -1973,9 +1974,11 @@ if(sh_audio){
 if(identify) {
   mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_FILENAME=%s\n", filename);
   if (sh_video) {
+    char fcc[5];
+    strlcpy(fcc, &(sh_video->format), 5);
     /* Assume FOURCC if all bytes >= 0x20 (' ') */
-    if (sh_video->format >= 0x20202020)
-	mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_VIDEO_FORMAT=%.4s\n", &sh_video->format);
+    if ((fcc[0] >= 0x20) && (fcc[1] >= 0x20) && (fcc[2] >= 0x20) && (fcc[3] >= 0x20))
+	mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_VIDEO_FORMAT=%s\n", fcc);
     else
 	mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_VIDEO_FORMAT=0x%08X\n", sh_video->format);
     mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_VIDEO_BITRATE=%d\n", sh_video->i_bps*8);
@@ -1985,11 +1988,13 @@ if(identify) {
     mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_VIDEO_ASPECT=%1.4f\n", sh_video->aspect);
   }
   if (sh_audio) {
+    char fcc[5];
     if (sh_audio->codec)
       mp_msg(MSGT_GLOBAL,MSGL_INFO, "ID_AUDIO_CODEC=%s\n", sh_audio->codec->name);
+    strlcpy(fcc, &(sh_audio->format), 5);
     /* Assume FOURCC if all bytes >= 0x20 (' ') */
-    if (sh_audio->format >= 0x20202020)
-      mp_msg(MSGT_GLOBAL,MSGL_INFO, "ID_AUDIO_FORMAT=%.4s\n", &sh_audio->format);
+    if ((fcc[0] >= 0x20) && (fcc[1] >= 0x20) && (fcc[2] >= 0x20) && (fcc[3] >= 0x20))
+      mp_msg(MSGT_GLOBAL,MSGL_INFO, "ID_AUDIO_FORMAT=%s\n", fcc);
     else
       mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_AUDIO_FORMAT=%d\n", sh_audio->format);
     mp_msg(MSGT_GLOBAL,MSGL_INFO,"ID_AUDIO_BITRATE=%d\n", sh_audio->i_bps*8);
@@ -3368,7 +3373,7 @@ if (stream->type==STREAMTYPE_DVDNAV && d
 	{
 #ifdef USE_SUB
 	if (sh_video) {
-		mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsSubVisibility, sub_visibility);
+		mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsSubVisibility, (long)sub_visibility);
 	}
 #endif
 	} break;
@@ -3488,11 +3493,11 @@ if (stream->type==STREAMTYPE_DVDNAV && d
 
 	case MP_CMD_GET_VO_FULLSCREEN : {
 	if(video_out && vo_config_count)
-		mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsVoFullscreen, vo_fs);
+		mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsVoFullscreen, (long)vo_fs);
 	} break;
     
     case MP_CMD_GET_PERCENT_POS : {
-	mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsPercentPos, demuxer_get_percent_pos(demuxer));
+	mp_msg(MSGT_GLOBAL,MSGL_INFO,MSGTR_AnsPercentPos, (long)demuxer_get_percent_pos(demuxer));
     } break;
     case MP_CMD_SWITCH_AUDIO :
         demuxer_switch_audio(demuxer);
@@ -3500,7 +3505,7 @@ if (stream->type==STREAMTYPE_DVDNAV && d
     case MP_CMD_RUN : {
 #ifndef __MINGW32__
         if(!fork()) {
-          execl("/bin/sh","sh","-c",cmd->args[0].v.s,NULL);
+          execl("/bin/sh","sh","-c",cmd->args[0].v.s,(char *)NULL);
           exit(0);
         }
 #endif
