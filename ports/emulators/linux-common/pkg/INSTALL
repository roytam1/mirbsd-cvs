#!/usr/bin/env mksh
# $MirOS$

PATH=/bin:/usr/bin:/sbin:/usr/sbin
PREFIX=${PKG_PREFIX:-/usr/local}

if [ $# -ne 2 ]; then
	print -u2 "usage: $0 distname { PRE-INSTALL | POST-INSTALL }"
	exit 1
fi

case $2 {
(PRE-INSTALL)
	if [[ -e $PREFIX/emul/linux/.setup_done ]]; then
		print -u2 'WARNING: this package has already been installed'
		print -u2 'and not properly deinstalled. NOT setting it up'
		print -u2 'automatically. To do this, execute the following'
		print -u2 "command: sudo ${PREFIX}/emul/linux/linuxctl setup"
	fi
	[[ $(sysctl -n kern.emul.linux) = 1 ]] || cat >&2 <<-EOF
		+---------------------------------------------------------
		|
		| ERROR: The Linux binary compatibility layer must be
		| enabled in order to use this port. To enable it,
		| execute the following command:
		|
		|	sudo sysctl -w kern.emul.linux=1
		|
		| Edit /etc/sysctl.conf to make this change permanent.
		| Refer to compat_linux(8) for further information.
		|
		+---------------------------------------------------------
	EOF
	[[ $(sysctl -n kern.emul.linux) = 1 ]] || exit 1
	;;
(POST-INSTALL)
	[[ -e $PREFIX/emul/linux/.setup_done ]] || \
	    ${PREFIX}/emul/linux/linuxctl autosetup
	[[ -e $PREFIX/emul/linux/.setup_done ]] || cat >&2 <<-EOF
		+===========================================================
		| To fully set up this port, execute the following command:
		| $ sudo ${PREFIX}/emul/linux/linuxctl setup
		+===========================================================
	EOF
	;;
(*)
	print -u2 "usage: $0 distname { PRE-INSTALL | POST-INSTALL }"
	exit 1
	;;
}

exit 0
