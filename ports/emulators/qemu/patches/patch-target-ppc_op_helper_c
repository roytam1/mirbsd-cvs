$MirOS$
--- target-ppc/op_helper.c.orig	Wed Apr 27 20:51:43 2005
+++ target-ppc/op_helper.c	Tue May  3 19:10:08 2005
@@ -18,6 +18,7 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 #include <math.h>
+#include <float.h>
 #include "exec.h"
 
 #define MEMSUFFIX _raw
@@ -213,7 +214,7 @@ void do_store_fpscr (uint32_t mask)
             uint32_t u[2];
         } s;
     } u;
-    int i, rnd_type;
+    int i, rnd_type = 0;
 
     u.d = FT0;
     if (mask & 0x80)
@@ -226,6 +227,18 @@ void do_store_fpscr (uint32_t mask)
     /* Set rounding mode */
     switch (env->fpscr[0] & 0x3) {
     case 0:
+#ifdef _BSD
+	rnd_type = FP_RN;
+	break;
+    case 1:
+	rnd_type = FP_RZ;
+	break;
+    case 2:
+	rnd_type = FP_RP;
+	break;
+    case 3:
+	rnd_type = FP_RM;
+#else
         /* Best approximation (round to nearest) */
         rnd_type = float_round_nearest_even;
         break;
@@ -241,6 +254,7 @@ void do_store_fpscr (uint32_t mask)
     case 3:
         /* Round toward -infinite */
         rnd_type = float_round_down;
+#endif
         break;
     }
     set_float_rounding_mode(rnd_type, &env->fp_status);
