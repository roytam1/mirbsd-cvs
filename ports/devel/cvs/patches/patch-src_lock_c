$MirOS$
--- src/lock.c.orig	Tue May 24 20:58:39 2005
+++ src/lock.c	Wed Sep 15 19:36:15 2010
@@ -71,6 +71,7 @@
 
 #include "cvs.h"
 
+__RCSID("$MirOS: ports/devel/cvs/patches/patch-src_lock_c,v 1.2 2007/03/10 23:53:49 tg Exp $");
 
 
 struct lock {
@@ -1318,6 +1319,10 @@ internal_lock (struct lock *lock, const 
     assert (!lock->repository);
     lock->repository = Xasprintf ("%s/%s", xrepository, CVSROOTADM);
     lock->free_repository = true;
+
+    /* do nothing if we know it fails anyway */
+    if (readonlyfs)
+      return 0;
 
     /* get the lock dir for our own */
     if (set_lock (lock, 1) != L_OK)
