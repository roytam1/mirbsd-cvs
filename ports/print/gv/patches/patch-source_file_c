$OpenBSD: patch-source_file_c,v 1.1 2002/10/04 18:29:14 brad Exp $
--- source/file.c.orig	Fri Jun  6 21:59:40 1997
+++ source/file.c	Sun Apr 30 16:58:55 2006
@@ -44,7 +44,7 @@
 #endif
 
 #include "paths.h"
-#include INC_X11(Intrinsic.h)
+#include <X11/Intrinsic.h>
 
 #include "types.h"
 #include "config.h"
@@ -193,9 +193,9 @@ file_getTmpFilename(baseDirectory,baseFi
       int i=1;
       do {
 #ifdef VMS
-         sprintf(tempFilename,"%sgv_%lx_%x_%s_%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
+         snprintf(tempFilename,256,"%sgv_%lx_%x_%s_%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
 #else
-         sprintf(tempFilename,"%sgv_%lx_%x_%s.%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
+         snprintf(tempFilename,256,"%sgv_%llx_%x_%s.%s.tmp",tmpDirBuf,time(NULL),i,tmpName,tmpExt);
 #endif
          file_translateTildeInPath(tempFilename);
          no_such_file = stat(tempFilename,&s);
@@ -282,6 +282,22 @@ file_fileIsNotUseful(fn)
   IMESSAGE(r)
   ENDMESSAGE(file_fileIsNotUseful)
   return(r);
+}
+
+/*############################################################*/
+/* file_nameIsDangerous */
+/*############################################################*/
+
+char *file_charsAllowedInName = "+,-./:=@\\^_";
+
+int
+file_nameIsDangerous(fn)
+  char *fn;
+{
+  for (; *fn; fn++)
+    if (!isalnum(*fn) && !strchr(file_charsAllowedInName, *fn))
+      return(1);
+  return(0);
 }
 
 /*############################################################*/
