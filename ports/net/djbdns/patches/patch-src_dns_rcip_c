$MirOS$
--- src/dns_rcip.c.orig	Sun Feb 11 21:11:23 2001
+++ src/dns_rcip.c	Sat May 14 22:27:17 2005
@@ -2,12 +2,19 @@
 #include "openreadclose.h"
 #include "byte.h"
 #include "ip4.h"
+#ifdef DJB_V6ONLY
+#include "ip6.h"
+#endif /* DJB_V6ONLY */
 #include "env.h"
 #include "dns.h"
 
 static stralloc data = {0};
 
+#ifndef DJB_V6ONLY
 static int init(char ip[64])
+#else
+static int init(char ip[256])
+#endif /* DJB_V6ONLY */
 {
   int i;
   int j;
@@ -20,10 +27,18 @@ static int init(char ip[64])
       if (*x == '.')
 	++x;
       else {
+#ifndef DJB_V6ONLY
         i = ip4_scan(x,ip + iplen);
+#else
+        i = ip6_scan(x,ip + iplen);
+#endif /* DJB_V6ONLY */
 	if (!i) break;
 	x += i;
+#ifndef DJB_V6ONLY
 	iplen += 4;
+#else
+	iplen += 16;
+#endif /* DJB_V6ONLY */
       }
     }
 
@@ -40,10 +55,15 @@ static int init(char ip[64])
             while ((data.s[i] == ' ') || (data.s[i] == '\t'))
               ++i;
             if (iplen <= 60)
+#ifndef DJB_V6ONLY
               if (ip4_scan(data.s + i,ip + iplen)) {
 		if (byte_equal(ip + iplen,4,"\0\0\0\0"))
 		  byte_copy(ip + iplen,4,"\177\0\0\1");
                 iplen += 4;
+#else
+              if (ip6_scan(data.s + i,ip + iplen)) {
+                iplen += 16;
+#endif /* DJB_V6ONLY */
 	      }
           }
           i = j + 1;
@@ -52,19 +72,36 @@ static int init(char ip[64])
   }
 
   if (!iplen) {
+#ifndef DJB_V6ONLY
     byte_copy(ip,4,"\177\0\0\1");
     iplen = 4;
+#else
+    byte_copy(ip,16,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1");
+    iplen = 16;
+#endif /* DJB_V6ONLY */
   }
+#ifndef DJB_V6ONLY
   byte_zero(ip + iplen,64 - iplen);
+#else
+  byte_zero(ip + iplen,256 - iplen);
+#endif /* DJB_V6ONLY */
   return 0;
 }
 
 static int ok = 0;
 static unsigned int uses;
 static struct taia deadline;
+#ifndef DJB_V6ONLY
 static char ip[64]; /* defined if ok */
+#else
+static char ip[256]; /* defined if ok */
+#endif /* DJB_V6ONLY */
 
+#ifndef DJB_V6ONLY
 int dns_resolvconfip(char s[64])
+#else
+int dns_resolvconfip(char s[256])
+#endif /* DJB_V6ONLY */
 {
   struct taia now;
 
@@ -81,6 +118,10 @@ int dns_resolvconfip(char s[64])
   }
 
   --uses;
+#ifndef DJB_V6ONLY
   byte_copy(s,64,ip);
+#else
+  byte_copy(s,256,ip);
+#endif /* DJB_V6ONLY */
   return 0;
 }
