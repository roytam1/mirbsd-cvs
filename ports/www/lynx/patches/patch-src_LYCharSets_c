$MirOS$

	Support ISO-8859-1 displays without system locale support,
	e.g. when the locale is always UTF-8 (MirBSD)

	This needs support from libncursesw (MirBSD #10uAA and up)
	and is a no-op if that ncurses patch isnâ€™t available

--- src/LYCharSets.c.orig	Mon May 25 21:05:07 2009
+++ src/LYCharSets.c	Sun Sep  6 14:10:04 2009
@@ -16,6 +16,10 @@
 
 #include <LYLeaks.h>
 
+#if defined(__MirBSD__) && defined(_nc_set_locale)
+extern void _nc_set_locale(char *);
+#endif
+
 HTkcode kanji_code = NOKANJI;
 BOOLEAN LYHaveCJKCharacterSet = FALSE;
 BOOLEAN DisplayCharsetMatchLocale = TRUE;
@@ -600,6 +604,18 @@ static void HTMLSetDisplayCharsetMatchLo
 {
     BOOLEAN match;
 
+#if defined(__MirBSD__) && defined(_nc_set_locale)
+    if (LYCharSet_UC[i].enc == UCT_ENC_UTF8) {
+	_nc_set_locale(NULL);
+	match = TRUE;
+    } else {
+	static char locbuf[32];
+
+	snprintf(locbuf, sizeof(locbuf), "en_US.%s", LYCharSet_UC[i].MIMEname);
+	_nc_set_locale(locbuf);
+	match = FALSE;
+    }
+#else
     if (LYHaveCJKCharacterSet) {
 	/*
 	 * We have no intention to pass CJK via UCTransChar if that happened.
@@ -635,6 +651,7 @@ static void HTMLSetDisplayCharsetMatchLo
 	}
 #endif
     }
+#endif /* MirBSD, _nc_set_locale */
 
     DisplayCharsetMatchLocale = match;
     return;
