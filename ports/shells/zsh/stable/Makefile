# $OpenBSD: Makefile,v 1.26 2004/05/14 18:59:18 lebel Exp $

COMMENT=		Z shell, Bourne shell-compatible, release flavor
COMMENT-zftp=		Z shell embedded ftp client

VERSION=		4.2.0
PKGNAME=		zsh-${VERSION:C/-//g}-${DASH_VER}
DISTNAME=		zsh-${VERSION}
CATEGORIES=		shells
MASTER_SITES_ZSH=	ftp://ftp.zsh.org/zsh/ \
			http://www.zsh.org/pub/ \
			ftp://ftp.sterling.com/zsh/ \
			ftp://ftp.rge.com/pub/zsh/ \
			ftp://ftp.cenatls.cena.dgac.fr/pub/shells/zsh/ \
			ftp://mrrl.lut.ac.uk/zsh/ \
			ftp://ftp.ips.oz.au/pub/packages/zsh/ \
			ftp://ftp.uit.no/pub/unix/shells/zsh/
MASTER_SITES+=		${MASTER_SITES_ZSH:=old/}
MASTER_SITES+=		${MASTER_SITES_ZSH}
HOMEPAGE=		http://www.zsh.org/

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

FLAVORS=		static

.if ${MACHINE_ARCH:Malpha} || ${MACHINE_ARCH:Mvax}
# for the time being, force static on alpha
FLAVOR?=        	static
.else
FLAVOR?=
.endif

CONFIGURE_STYLE=	autoconf
AUTOCONF_NEW=		Yes
CONFIGURE_ARGS+=	--enable-zsh-mem \
			--enable-zsh-secure-free \
			--enable-maildir-support

.if ${FLAVOR:L} == "static"
LDFLAGS+=		-static
CONFIGURE_ARGS+=	--disable-dynamic
.else
# we only enable sub-packages if the FLAVOR is not static
MULTI_PACKAGES=		-zftp
SUBPACKAGE?=
.  for i in ${MULTI_PACKAGES}
PKGNAME$i=		zsh$i-${VERSION:C/-//g}-${DASH_VER}
.  endfor
.  if defined(PACKAGING) && !empty(SUBPACKAGE)
RUN_DEPENDS+=		::shells/zsh/stable
.  endif
CONFIGURE_ARGS+=	${CONFIGURE_SHARED:S/shared/dynamic/}
.endif

SUBST_VARS=		VERSION

REGRESS_FLAGS=		INSTALL_PROGRAM="install -c -s -m 555" \
	        	INSTALL_DATA="install -c -m 444" \
			INSTALL="install -c" \
			TMPPREFIX=${WRKBUILD}/tmp

.include <bsd.port.mk>
