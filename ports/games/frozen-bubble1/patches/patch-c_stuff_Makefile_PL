$MirOS: ports/games/frozen-bubble/patches/patch-c_stuff_Makefile_PL,v 1.1 2005/06/24 17:41:33 tg Exp $
$NetBSD: patch-aa,v 1.4 2003/04/18 08:07:51 salo Exp $
--- c_stuff/Makefile.PL.orig	Thu Apr 18 09:43:58 2002
+++ c_stuff/Makefile.PL	Mon Nov  6 19:06:08 2006
@@ -16,7 +16,7 @@ $main;
 }
 EOTEST
 	close(CTEST);
-	$r = system("$Config{cc} -o $fname $fname.c $cflags $libs 2>/dev/null 1>/dev/null");
+	$r = system("$Config{cc} -o $fname $fname.c $cflags $libs >>res 2>&1");
 	warn("RUNNING: $Config{cc} -o $fname $fname.c $cflags $libs\n") if $ENV{VERBOSE};
 	unlink($fname, "$fname.c");
 	return $r == 0;
@@ -34,8 +34,8 @@ system("sdl-config --cflags 2>/dev/null 
 ccompile('#include <SDL/SDL.h>
           #include <SDL/SDL_mixer.h>',
 	 '',
-	 `sdl-config --cflags`,
-	 chomp_(`sdl-config --libs`) . ' -lSDL_mixer')
+	 chomp_($ENV{CFLAGS} . ' ' . $ENV{CPPFLAGS} . ' ' . `sdl-config --cflags`),
+	 chomp_($ENV{LDFLAGS} . ' ' . `sdl-config --libs`) . ' -lSDL_mixer -lvorbisfile -lvorbis -logg')
   or
   die_ 'SDL_mixer is needed (and, by the way, version >= 1.2.2 will be needed)';
 
@@ -43,18 +43,18 @@ ccompile('#include <SDL/SDL.h>
 ccompile('#include <SDL/SDL.h>
           #include <SDL/SDL_mixer.h>',
 	 'Mix_FadeInMusicPos(NULL, 0, 0, 0);',
-	 `sdl-config --cflags`,
-	 chomp_(`sdl-config --libs`) . ' -lSDL_mixer')
+	 chomp_($ENV{CFLAGS} . ' ' . `sdl-config --cflags`),
+	 chomp_($ENV{LDFLAGS} . ' ' . `sdl-config --libs`) . ' -lSDL_mixer -lvorbisfile -lvorbis -logg')
   or
   die_ 'SDL_mixer >= 1.2.2 is needed (function Mix_FadeInMusicPos is missing)';
 
 
 WriteMakefile(
     'NAME'         => 'fb_c_stuff',
-    'LIBS'         => [ chomp_(`sdl-config --libs`) . ' -lSDL_mixer'],
+    'LIBS'         => [ chomp_($ENV{LDFLAGS} . ' ' . `sdl-config --libs`) . ' -lSDL_mixer -lvorbisfile -lvorbis -logg'],
     'VERSION_FROM' => 'fb_c_stuff.pm', # finds VERSION
     'OBJECT'       => 'fb_c_stuff.o',
     'INC'          => chomp_(`sdl-config --cflags`) . ' -I.',
-    'OPTIMIZE'     => '-O2 -Wall',
+    'OPTIMIZE'     => chomp_('-O2 -Wall ' . $ENV{CFLAGS}),
     'MAKEFILE'     => 'Makefile_c',
 );
