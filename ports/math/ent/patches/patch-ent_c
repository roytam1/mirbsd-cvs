$MirOS: ports/math/ent/patches/patch-ent_c,v 1.3 2008/04/06 17:06:44 tg Exp $
--- ent.c.orig	Tue Oct 20 17:13:53 1998
+++ ent.c	Tue Sep 21 18:44:49 2010
@@ -18,6 +18,7 @@
 */
 
 #include <stdio.h>
+#include <stdlib.h>
 #include <string.h>
 #include <ctype.h>
 #include <math.h>
@@ -25,6 +26,16 @@
 #include <unistd.h>
 #endif
 
+#include <sys/param.h>
+#if defined(MirBSD) && (MirBSD > 0x0A15)
+#include <adler32.h>
+#ifndef arc4random_pushb_fast
+#define arc4random_pushb_fast arc4random_pushb
+#endif
+
+__RCSID("$MirOS: ports/math/ent/patches/patch-ent_c,v 1.3 2008/04/06 17:06:44 tg Exp $");
+#endif
+
 #include "iso8859.h"
 #include "randtest.h"
 
@@ -127,7 +138,12 @@ int main(int argc, char *argv[])
 	    fold = FALSE,	      /* Fold upper to lower */
 	    binary = FALSE,	      /* Treat input as a bitstream */
 	    terse = FALSE;	      /* Terse (CSV format) output */
+#if defined(MirBSD) && (MirBSD > 0x0A15)
+	ADLER32_CTX ctx;
 
+	ADLER32Init(&ctx);
+#endif
+
         while ((opt = getopt(argc, argv, "bcftu?BCFTU")) != -1) {
 	    switch (toISOlower(opt)) {
                  case 'b':
@@ -176,6 +192,11 @@ int main(int argc, char *argv[])
 	while ((oc = fgetc(fp)) != EOF) {
 	   unsigned char ocb;
 
+#if defined(MirBSD) && (MirBSD > 0x0A15)
+	   ocb = oc;
+	   ADLER32Update(&ctx, &ocb, 1);
+#endif
+
 	   if (fold && isISOalpha(oc) && isISOupper(oc)) {
 	      oc = toISOlower(oc);
 	   }
@@ -195,6 +216,10 @@ int main(int argc, char *argv[])
 	   rt_add(&ocb, 1);
 	}
 	V fclose(fp);
+
+#if defined(MirBSD) && (MirBSD > 0x0A15)
+	arc4random_pushb_fast(&ctx, sizeof (ctx));
+#endif
 
 	/* Complete calculation and return sequence metrics */
 
